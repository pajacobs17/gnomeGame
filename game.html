<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Welcome</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="style.css" rel="stylesheet" type="text/css" />
	
	<!--SCRIPTS -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="simpleGame.js"></script>
	
	<!--Class files -->
	<script src="Mower.js"></script>
	<script src="Gnome.js"></script>
	<script src="Grass.js"></script>
	
</head>

<body onload="init()" style="background-color: #009900;">

	<script>
		//Game vars
        var game = new Scene();
		game.setBG("green");
		game.setSize(500, 500);
		//get the canvas elements for the game to allow for dynamic resizing
        var all = document.getElementsByTagName("canvas");
        var canvas = all[0];
		//contains all the grass sprite objects
		var board = new Array();
		
		
        //list of the gnomes
        var gnomeList = [];
		//the brandy mower sprite
        var brandy

         /* function should return one number that are within bounds of the canvas */
        function randNum(num){
          //setting max and min to make sure Gnomes won't go beyond/touch border
          var max = (num - 100);
          var min = 200;
          var rand = Math.floor(Math.random() * (max - min)) + min;
          return rand;
        }

        function init(){
			 canvas.setAttribute("id", "gameCanvas");
		 
            brandy = new Mower("img/Brandy-Forward.png");

            gnomeList.push(new Gnome("img/blueGnome.png"));
            gnomeList.push(new Gnome("img/purpleGnome.png"));
			gnomeList.push(new Gnome("img/purpleGnome.png"));
			gnomeList.push(new Gnome("img/orangeGnome.png"));
			
			createBoard();
			
            game.start();
        }
        
        function update(){
            game.clear();
			
			displayBoard();
			
            //for each frame:
              //set speed to 5, 
              //give the Gnome a new random direction, 
              //redraw the Gnome, and 
              //check for collision
            for(i = 0; i < gnomeList.length; i++) {
              gnomeList[i].setSpeed(5);
              newDir = (Math.random() * 90 -45);
              gnomeList[i].changeMoveAngleBy(newDir);
              gnomeList[i].update();
              checkLoss(gnomeList[i]);
            }
			
            //check the keypress for player and redraw player
            brandy.checkKeys();
            brandy.update();
			
			if(checkWin() == true) {
				alert("Congrats. You won!");
				game.stop();
			}
        }

        /*
          check whether or not the player has colllided with a Gnome
          if the player has collided with a Gnome, end the game with an alert and beyond
          refreshing the page
        */
        function checkLoss(gnome){
          //if a collision has occured, end the game
            if (brandy.collidesWith(gnome)){
                alert("You have failed in the ultimte quest to mow your lawn. Good luck next time.");
                game.stop();
            }
        }
		
		function checkWin() {
			for(var i = 0; i < board.length; i++) {
				for(var j = 0; j < board[i].length; j++) {
					if(board[i][j].visible == true) {
						return false;
					}
				}
			}
			return true;
		}
			
		function displayBoard() {
			for(var i = 0; i < board.length; i++) {
				for(var j = 0; j < board[i].length; j++) {
					checkMowed(board[i][j]);
					board[i][j].update();
				}
			}
		}
		
		function createBoard() {
			var rowIndex = 0;
			var columnIndex = 0;
			for(var i = 25; i <= canvas.clientHeight; i += 50) {
				board[columnIndex] = new Array();
				for(var j = 25; j <= canvas.clientWidth; j += 50) {
					board[columnIndex][rowIndex] = new Sprite(game, "img/grass.jpg", 50, 50);
					board[columnIndex][rowIndex].setPosition(i, j);
					rowIndex++;	
				}
			rowIndex = 0;
			columnIndex++;
			}
		}
		
		function checkMowed(grass) {
			if(brandy.collidesWith(grass)) {
				grass.hide();
			}
		}

		
	</script>
</body>

</html>
