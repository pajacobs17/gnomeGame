<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Gnome Alert</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href="style.css" rel="stylesheet" type="text/css" />
</head>

<body onload="init()" style="background-color: #009900;">

	<div id="scoreBoard">
	<a href="index.html">
          <span class="glyphicon glyphicon-arrow-left"></span> BACK
        </a>
	</div>

	<!-- <canvas id="gameCanvas">
	</canvas> -->

	<!--SCRIPTS -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="simpleGame.js"></script>
  
  <!--Class files -->
	<script src="Mower.js"></script>
	<script src="Gnome.js"></script>

	<body onload="init()" style="background-color: #009900;">

		<script>
			//Game vars
        var game = new Scene();
        var all = document.getElementsByTagName("canvas");
        var canvas = all[0];
		    
        //Sprites
        var board = new Array();
        var gnomeList = [];
        var brandy
  
         
         /* function should return one number that are within bounds of the canvas */
      function randNum(num){
          //setting max and min to make sure gnomes won't go beyond/touch border
          var max = (num - 100);
          var min = 200;
          var rand = Math.floor(Math.random() * (max - min)) + min;
          return rand;
        }

      function init(){
			 canvas.setAttribute("id", "gameCanvas");
            brandy = new mower();
            gnomeList.push(new gnome("img/blueGnome.png"));
            gnomeList.push(new gnome("img/purpleGnome.png"));
            gnomeList.push(new gnome("img/paulGnome.png"));
			      createBoard();
            
            game.start();
        }
        
      function update(){
            game.clear();

              for (i=0; i < board.length; i++){
              checkMowed(board[i]);
              board[i].update();
            }

			
            /*for each frame:
              - set speed to 5, 
              - give the gnome a new random direction, 
              - redraw the gnome, and 
              - check for collision
              */
            for(i = 0; i < gnomeList.length; i++) {
              gnomeList[i].setSpeed(5);
              newDir = (Math.random() * 90 -45);
              gnomeList[i].changeMoveAngleBy(newDir);
              gnomeList[i].update();
              checkCollisions(gnomeList[i]);
            }
            //check the keypress for player and redraw player
            brandy.checkKeys();
            brandy.update();
			
        }
        /*
          check whether or not the player has colllided with a gnome
          - if the player has collided with a gnome, end the game with an alert and beyond
          refreshing the page
        */
        function checkCollisions(gnome){
            if (brandy.collidesWith(gnome)){
                alert("You have failed in the ultimte quest to mow your lawn. Good luck next time.")
                game.stop();
                game.clear();
                //document.location.href = "";
            }
        }

        /*
          check whether or not the player has mowed a patch of grass
            - if the player has mowed grass then hide grass patch
        */
        function checkMowed(grass){
          if (brandy.collidesWith(grass)){
            grass.hide();
            console.log("hide");
          }
        }
		
    /*
    This function create all the grass patches dynamically. There should be 10 grass patches vertically and 20 across

    NOTES:
    i = x = width
    j = y = height
    */
        function createBoard() {
      var count = 0;
      var height = canvas.clientHeight;
      var width = canvas.clientWidth;
      var grassHeight = height/10;
      var grassWidth = width/20;

    	for(var i = grassWidth/2 ; i <= width; i += grassWidth) {
				for(var j = grassHeight/2; j <= height; j += grassHeight) {
					board.push(new Sprite(game, "img/grass.jpg", grassWidth, grassHeight));
					board[count].setPosition(i, j);
					board[count].update();
					count++;
          console.log("i = " + i);
           console.log("j = " + j);
				}
			}
    
      // ONLY FOR TESTING PURPOSES
      // console.log(board[0]);
      // console.log(grassHeight, grassWidth);
      // console.log("height: " + height);
      // console.log("width: " + width);
      // console.log(count);
      }
		</script>
	</body>

</html>